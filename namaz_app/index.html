<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞–º–∞–∑.–ò–ò ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—É—Ç–µ–≤–æ–¥–∏—Ç–µ–ª—å</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å—Ç–∏–ª–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è */
        :root {
            --primary: #00897B;
            --primary-light: #E0F2F1;
            --accent: #FFCA28;
            --bg: #F0F7F7;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: #1A3A3A;
            scroll-behavior: smooth;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –º–∞—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–∫–ª–∞ (Glassmorphism) */
        .glass-panel {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 24px;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ */
        .chart-container {
            position: relative;
            width: 100%;
            height: 320px;
            margin: 0 auto;
        }

        /* –û–∫–Ω–æ —á–∞—Ç–∞ */
        .ai-chat-window {
            display: none;
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 380px;
            max-width: calc(100vw - 48px);
            height: 550px;
            z-index: 1000;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .ai-chat-window.active {
            display: flex;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
        .loading-dots:after {
            content: '.';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {

            0%,
            20% {
                content: '.';
            }

            40% {
                content: '..';
            }

            60% {
                content: '...';
            }

            80%,
            100% {
                content: '';
            }
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #B2DFDB;
            border-radius: 10px;
        }

        .message-ai {
            background-color: #F1F5F9;
            color: #1E293B;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }

        .message-user {
            background-color: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }
    </style>
</head>

<body class="antialiased selection:bg-teal-100 selection:text-teal-900">

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="fixed top-0 w-full z-50 glass-panel !rounded-none border-b border-teal-100 shadow-sm px-6 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <span class="text-3xl">üïå</span>
                <h1 class="font-extrabold text-xl tracking-tighter text-teal-800 uppercase">–ù–∞–º–∞–∑.–ò–ò</h1>
            </div>
            <div class="hidden md:flex gap-8 font-semibold text-sm text-teal-700">
                <a href="#home" class="hover:text-teal-500 transition-colors">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="#wudu" class="hover:text-teal-500 transition-colors">–û–º–æ–≤–µ–Ω–∏–µ</a>
                <a href="#salah" class="hover:text-teal-500 transition-colors">–°—Ç—Ä—É–∫—Ç—É—Ä–∞</a>
                <a href="#stats" class="hover:text-teal-500 transition-colors">–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="pt-24 pb-20 px-4 md:px-8 max-w-7xl mx-auto space-y-20">

        <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
        <section id="home" class="grid grid-cols-1 lg:grid-cols-2 gap-10 items-center pt-8">
            <div class="space-y-10">
                <div
                    class="inline-flex items-center gap-2 px-4 py-1.5 bg-teal-100 text-teal-800 rounded-full text-xs font-bold uppercase tracking-wider">
                    <span class="w-2 h-2 bg-teal-500 rounded-full animate-pulse"></span> –î—É—Ö–æ–≤–Ω—ã–π —Ä–æ—Å—Ç
                </div>
                <h2 class="text-5xl md:text-7xl font-black text-teal-950 leading-[1.1] tracking-tight">
                    –ù–∞—É—á–∏—Ç–µ—Å—å <br /><span class="text-teal-600">–º–æ–ª–∏—Ç—å—Å—è</span> <br />–ø—Ä–∞–≤–∏–ª—å–Ω–æ
                </h2>
                <p class="text-lg text-slate-600 leading-relaxed max-w-lg">
                    –í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ –∏—Å–ª–∞–º—Å–∫–æ–π –ø—Ä–∞–∫—Ç–∏–∫–∏. –ò–∑—É—á–∞–π—Ç–µ –æ—Å–Ω–æ–≤—ã –Ω–∞–º–∞–∑–∞ —Å –ø–æ–º–æ—â—å—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –∏
                    —É–º–Ω–æ–≥–æ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞.
                </p>

                <!-- –ë–ª–æ–∫ –ù–∞–ø—É—Ç—Å—Ç–≤–∏—è –î–Ω—è -->
                <div class="p-8 bg-teal-900 rounded-[32px] text-white shadow-2xl relative overflow-hidden group">
                    <div
                        class="absolute -right-10 -top-10 w-48 h-48 bg-teal-800 rounded-full opacity-30 transition-transform group-hover:scale-125">
                    </div>
                    <div class="relative z-10">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                            <span>‚ú®</span> –ù–∞–ø—É—Ç—Å—Ç–≤–∏–µ –æ—Ç –ò–ò
                        </h3>
                        <p id="inspiration-text" class="text-teal-50/80 leading-relaxed mb-8 italic min-h-[3rem]">
                            –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥—É—Ö–æ–≤–Ω—ã–π —Å–æ–≤–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.
                        </p>
                        <div id="ai-error-status"
                            class="hidden p-3 bg-red-500/10 border border-red-500/20 rounded-xl mb-4 text-[11px] text-red-200">
                        </div>
                        <button onclick="fetchInspiration()" id="inspire-btn"
                            class="bg-amber-400 hover:bg-amber-500 text-teal-950 font-bold py-4 px-10 rounded-2xl shadow-xl transition-all active:scale-95 flex items-center gap-3">
                            <span id="inspire-label">–ü–æ–ª—É—á–∏—Ç—å —Å–æ–≤–µ—Ç</span>
                            <div id="inspire-loader"
                                class="hidden w-5 h-5 border-4 border-teal-950 border-t-transparent rounded-full animate-spin">
                            </div>
                        </button>
                    </div>
                </div>
            </div>

            <div class="glass-panel p-8 shadow-xl border-teal-50">
                <h3 class="text-lg font-bold text-teal-900 mb-6 flex items-center gap-2">
                    <span class="w-1.5 h-6 bg-amber-400 rounded-full"></span>
                    –ü–æ–ª—å–∑–∞ –º–æ–ª–∏—Ç–≤—ã
                </h3>
                <div class="chart-container">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </section>

        <!-- –†–∞–∑–¥–µ–ª –û–º–æ–≤–µ–Ω–∏–µ -->
        <section id="wudu" class="space-y-10">
            <div class="text-center space-y-4">
                <h2 class="text-4xl font-black text-teal-950">–†–∏—Ç—É–∞–ª—å–Ω–æ–µ –æ–º–æ–≤–µ–Ω–∏–µ (–í—É–¥—É)</h2>
                <p class="text-slate-600 max-w-2xl mx-auto italic">–ß–∏—Å—Ç–æ—Ç–∞ ‚Äî —ç—Ç–æ –∫–ª—é—á –∫ –º–æ–ª–∏—Ç–≤–µ. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —ç—Ç–∏ —á–µ—Ç—ã—Ä–µ
                    —à–∞–≥–∞ –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º.</p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 1 -->
                <div onclick="openWuduModal(1)"
                    class="glass-panel p-8 hover:scale-105 transition-all duration-300 group cursor-pointer border-teal-50 shadow-md hover:shadow-xl">
                    <div class="text-3xl font-black text-teal-600/20 mb-4 font-serif">I</div>
                    <div class="text-5xl mb-5">ü§≤</div>
                    <h4 class="text-xl font-bold text-teal-950 mb-3">–ù–∞–º–µ—Ä–µ–Ω–∏–µ</h4>
                    <p class="text-sm text-slate-500 leading-relaxed font-medium">–í—ã—Ä–∞–∑–∏—Ç–µ –Ω–∏—è—Ç –∏ –≤—ã–º–æ–π—Ç–µ –∫–∏—Å—Ç–∏ —Ä—É–∫.</p>
                </div>
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 2 -->
                <div onclick="openWuduModal(2)"
                    class="glass-panel p-8 hover:scale-105 transition-all duration-300 group cursor-pointer border-teal-50 shadow-md hover:shadow-xl">
                    <div class="text-3xl font-black text-teal-600/20 mb-4 font-serif">II</div>
                    <div class="text-5xl mb-5">üíß</div>
                    <h4 class="text-xl font-bold text-teal-950 mb-3">–õ–∏—Ü–æ</h4>
                    <p class="text-sm text-slate-500 leading-relaxed font-medium">–ü—Ä–æ–ø–æ–ª–æ—â–∏—Ç–µ —Ä–æ—Ç, –Ω–æ—Å –∏ –≤—ã–º–æ–π—Ç–µ –≤—Å—ë
                        –ª–∏—Ü–æ.</p>
                </div>
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 3 -->
                <div onclick="openWuduModal(3)"
                    class="glass-panel p-8 hover:scale-105 transition-all duration-300 group cursor-pointer border-teal-50 shadow-md hover:shadow-xl">
                    <div class="text-3xl font-black text-teal-600/20 mb-4 font-serif">III</div>
                    <div class="text-5xl mb-5">üí™</div>
                    <h4 class="text-xl font-bold text-teal-950 mb-3">–†—É–∫–∏ –∏ –ì–æ–ª–æ–≤–∞</h4>
                    <p class="text-sm text-slate-500 leading-relaxed font-medium">–ú–æ–π—Ç–µ —Ä—É–∫–∏ –¥–æ –ª–æ–∫—Ç–µ–π –∏ –ø—Ä–æ—Ç—Ä–∏—Ç–µ
                        –≥–æ–ª–æ–≤—É.</p>
                </div>
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 4 -->
                <div onclick="openWuduModal(4)"
                    class="glass-panel p-8 hover:scale-105 transition-all duration-300 group cursor-pointer border-teal-50 shadow-md hover:shadow-xl">
                    <div class="text-3xl font-black text-teal-600/20 mb-4 font-serif">IV</div>
                    <div class="text-5xl mb-5">ü¶∂</div>
                    <h4 class="text-xl font-bold text-teal-950 mb-3">–ù–æ–≥–∏</h4>
                    <p class="text-sm text-slate-500 leading-relaxed font-medium">–¢—â–∞—Ç–µ–ª—å–Ω–æ –≤—ã–º–æ–π—Ç–µ –æ–±–µ –Ω–æ–≥–∏ –¥–æ
                        —â–∏–∫–æ–ª–æ—Ç–æ–∫.</p>
                </div>
            </div>
        </section>

        <!-- –†–∞–∑–¥–µ–ª –°—Ç—Ä—É–∫—Ç—É—Ä–∞ -->
        <section id="salah" class="grid grid-cols-1 lg:grid-cols-3 gap-10 items-start">
            <div class="lg:col-span-1 space-y-8 p-4">
                <h2 class="text-4xl font-black text-teal-950">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ù–∞–º–∞–∑–∞</h2>
                <p class="text-slate-600 leading-relaxed">–ú–æ–ª–∏—Ç–≤–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ü–∏–∫–ª–æ–≤ ‚Äî —Ä–∞–∫–∞–∞—Ç–æ–≤. –ì—Ä–∞—Ñ–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—ä–µ–º
                    –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.</p>
                <div class="space-y-5">
                    <div class="flex items-center gap-4 p-4 glass-panel border-l-8 border-teal-600 !rounded-xl">
                        <div class="text-2xl font-bold text-teal-600">üïã</div>
                        <div>
                            <strong class="text-teal-950 block text-sm uppercase tracking-wider">–§–∞—Ä–¥</strong>
                            <span class="text-xs text-slate-500">–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–∏–∫–ª—ã</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 p-4 glass-panel border-l-8 border-amber-400 !rounded-xl">
                        <div class="text-2xl font-bold text-amber-500">‚ú®</div>
                        <div>
                            <strong class="text-amber-900 block text-sm uppercase tracking-wider">–°—É–Ω–Ω–∞</strong>
                            <span class="text-xs text-slate-500">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–ª–∏—Ç–≤—ã</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="lg:col-span-2 glass-panel p-10 shadow-2xl border-teal-50">
                <div class="chart-container !h-[450px]">
                    <canvas id="barChart"></canvas>
                </div>
            </div>
        </section>

        <!-- –†–∞–∑–¥–µ–ª –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
        <section id="stats" class="glass-panel p-10 md:p-16 shadow-2xl border-teal-50 text-center">
            <h2 class="text-3xl font-black text-teal-950 mb-10 flex items-center justify-center gap-3">
                <span class="text-amber-500">üìà</span> –î—É—Ö–æ–≤–Ω–∞—è –¥–∏–Ω–∞–º–∏–∫–∞ –¥–Ω—è
            </h2>
            <div class="chart-container !h-[380px]">
                <canvas id="lineChart"></canvas>
            </div>
            <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-10">
                <div class="p-6 rounded-3xl bg-teal-50/50 border border-teal-100">
                    <p class="text-5xl font-black text-teal-700 mb-2">17</p>
                    <p class="text-xs text-slate-400 uppercase font-extrabold tracking-widest">–†–∞–∫–∞–∞—Ç–æ–≤ –≤ –¥–µ–Ω—å</p>
                </div>
                <div class="p-6 rounded-3xl bg-teal-50/50 border border-teal-100">
                    <p class="text-5xl font-black text-teal-700 mb-2">5</p>
                    <p class="text-xs text-slate-400 uppercase font-extrabold tracking-widest">–ú–æ–ª–∏—Ç–≤–µ–Ω–Ω—ã—Ö –ø–∞—É–∑</p>
                </div>
                <div class="p-6 rounded-3xl bg-teal-50/50 border border-teal-100">
                    <p class="text-5xl font-black text-teal-700 mb-2">365</p>
                    <p class="text-xs text-slate-400 uppercase font-extrabold tracking-widest">–î–Ω–µ–π –≤ –≥–æ–¥—É</p>
                </div>
            </div>
        </section>

    </main>

    <!-- –í–∏–¥–∂–µ—Ç —á–∞—Ç–∞ –ò–ò -->
    <div id="aiChat" class="ai-chat-window glass-panel border-teal-200">
        <div class="bg-teal-900 p-6 text-white flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div
                    class="w-10 h-10 bg-amber-400 rounded-2xl flex items-center justify-center text-teal-950 font-black shadow-lg">
                    –ò–ò</div>
                <div>
                    <h4 class="font-bold text-sm tracking-tight">–ú—É–¥—Ä—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫</h4>
                    <span class="flex items-center gap-1.5 text-[10px] text-teal-400 font-bold uppercase">
                        <span class="w-1.5 h-1.5 bg-teal-500 rounded-full animate-pulse"></span> –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ
                    </span>
                </div>
            </div>
            <button onclick="toggleChat()" class="p-2 hover:bg-white/10 rounded-xl transition-colors">‚úï</button>
        </div>
        <div id="chatMessages" class="flex-1 overflow-y-auto p-6 space-y-5 custom-scrollbar bg-white/50 flex flex-col">
            <div class="message message-ai px-4 py-3 rounded-2xl shadow-sm">
                –ê—Å—Å–∞–ª—è–º—É –∞–ª–µ–π–∫—É–º! –Ø –≤–∞—à –¥—É—Ö–æ–≤–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫. –ö–∞–∫–æ–π —É –≤–∞—Å –≤–æ–ø—Ä–æ—Å –ø–æ –æ–º–æ–≤–µ–Ω–∏—é –∏–ª–∏ —Å–æ–≤–µ—Ä—à–µ–Ω–∏—é –Ω–∞–º–∞–∑–∞?
            </div>
        </div>
        <div class="p-4 bg-white/80 border-t border-teal-100 flex gap-3">
            <input type="text" id="userInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å..."
                onkeypress="if(event.key==='Enter') sendMessage()"
                class="flex-1 bg-teal-50 border-none rounded-2xl px-6 py-4 text-sm focus:ring-2 focus:ring-teal-500 outline-none font-medium">
            <button onclick="sendMessage()"
                class="bg-teal-700 text-white w-14 h-14 rounded-2xl flex items-center justify-center hover:bg-teal-800 transition-all shadow-lg active:scale-90">
                ‚û§
            </button>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –≤—ã–∑–æ–≤–∞ —á–∞—Ç–∞ -->
    <button onclick="toggleChat()"
        class="fixed bottom-10 right-10 w-20 h-20 bg-teal-700 text-white rounded-[30px] shadow-2xl flex items-center justify-center text-4xl hover:scale-110 hover:bg-teal-600 active:scale-95 transition-all z-40 group">
        <span class="group-hover:rotate-12 transition-transform">‚ú®</span>
    </button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –û–º–æ–≤–µ–Ω–∏—è -->
    <div id="wuduModal" class="modal-overlay" onclick="closeWuduModal()">
        <div class="glass-panel p-10 max-w-md w-full m-4 shadow-2xl relative" onclick="event.stopPropagation()">
            <button onclick="closeWuduModal()"
                class="absolute top-4 right-4 text-slate-400 hover:text-teal-600 text-xl">‚úï</button>
            <div id="wuduModalContent" class="space-y-6">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
        // --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API ---

        // –í–ê–ñ–ù–û: 
        // 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://aistudio.google.com/ –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π API –∫–ª—é—á.
        // 2. –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –∫–ª—é—á –Ω–∏–∂–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é apiKey.
        const apiKey = "AIzaSyAyvCTweYef5Of-ITGV9Xo8X01hLup78-I";
        const GEMINI_MODEL = "gemini-2.5-flash-preview-09-2025";

        // –§—É–Ω–∫—Ü–∏—è –≤—ã–∑–æ–≤–∞ Gemini —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
        async function callGemini(prompt, systemPrompt = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }]
            };
            if (systemPrompt) {
                payload.systemInstruction = { parts: [{ text: systemPrompt }] };
            }

            let lastErr = "";
            for (let i = 0; i < 5; i++) {
                try {
                    const resp = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!resp.ok) {
                        const errData = await resp.json().catch(() => ({}));
                        lastErr = errData.error?.message || `–û—à–∏–±–∫–∞ ${resp.status}`;
                        throw new Error(lastErr);
                    }

                    const data = await resp.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (text) return text;
                    throw new Error("–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –º–æ–¥–µ–ª–∏.");
                } catch (e) {
                    lastErr = e.message;
                    await new Promise(r => setTimeout(r, Math.pow(2, i) * 1000));
                }
            }
            return `### –û–®–ò–ë–ö–ê: ${lastErr}. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–ª–∏ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞.`;
        }

        // --- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤ –û–º–æ–≤–µ–Ω–∏—è ---
        const wuduData = {
            1: { title: "–ù–∞–º–µ—Ä–µ–Ω–∏–µ –∏ –ö–∏—Å—Ç–∏", icon: "ü§≤", desc: "–ú—ã—Å–ª–µ–Ω–Ω–æ –≤—ã—Ä–∞–∑–∏—Ç–µ –Ω–∏—è—Ç (–Ω–∞–º–µ—Ä–µ–Ω–∏–µ) —Å–æ–≤–µ—Ä—à–∏—Ç—å –æ–º–æ–≤–µ–Ω–∏–µ —Ä–∞–¥–∏ –í—Å–µ–≤—ã—à–Ω–µ–≥–æ. –°–∫–∞–∂–∏—Ç–µ '–ë–∏—Å–º–∏–ª–ª—è—Ö'. –í—ã–º–æ–π—Ç–µ –∫–∏—Å—Ç–∏ —Ä—É–∫ —Ç—Ä–∏ —Ä–∞–∑–∞, –ø—Ä–æ–º—ã–≤–∞—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –º–µ–∂–¥—É –ø–∞–ª—å—Ü–∞–º–∏." },
            2: { title: "–†–æ—Ç, –ù–æ—Å –∏ –õ–∏—Ü–æ", icon: "üíß", desc: "–ü—Ä–æ–ø–æ–ª–æ—â–∏—Ç–µ —Ä–æ—Ç —Ç—Ä–∏ —Ä–∞–∑–∞. –ü—Ä–æ–º–æ–π—Ç–µ –Ω–æ—Å —Ç—Ä–∏ —Ä–∞–∑–∞. –ó–∞—Ç–µ–º –≤—ã–º–æ–π—Ç–µ –≤—Å–µ –ª–∏—Ü–æ —Ç—Ä–∏ —Ä–∞–∑–∞: –æ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –≤–æ–ª–æ—Å –Ω–∞ –ª–±—É –¥–æ –Ω–∏–∑–∞ –ø–æ–¥–±–æ—Ä–æ–¥–∫–∞ –∏ –æ—Ç —É—Ö–∞ –¥–æ —É—Ö–∞." },
            3: { title: "–†—É–∫–∏ –∏ –ì–æ–ª–æ–≤–∞", icon: "üí™", desc: "–í—ã–º–æ–π—Ç–µ –ø—Ä–∞–≤—É—é —Ä—É–∫—É –¥–æ –ª–æ–∫—Ç—è –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Ç—Ä–∏ —Ä–∞–∑–∞, –∑–∞—Ç–µ–º –ª–µ–≤—É—é. –ü—Ä–æ—Ç—Ä–∏—Ç–µ –≤–ª–∞–∂–Ω–æ–π –ª–∞–¥–æ–Ω—å—é —á–µ—Ç–≤–µ—Ä—Ç—å –≥–æ–ª–æ–≤—ã (–æ–¥–∏–Ω —Ä–∞–∑). –ü—Ä–æ—Ç—Ä–∏—Ç–µ —É—à–∏ –∏ —à–µ—é." },
            4: { title: "–ù–æ–≥–∏", icon: "ü¶∂", desc: "–í—ã–º–æ–π—Ç–µ –ø—Ä–∞–≤—É—é –Ω–æ–≥—É –¥–æ —â–∏–∫–æ–ª–æ—Ç–æ–∫ —Ç—Ä–∏ —Ä–∞–∑–∞, –∑–∞—Ç–µ–º –ª–µ–≤—É—é. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–æ–¥–∞ –ø–æ–ø–∞–ª–∞ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –ø–∞–ª—å—Ü–∞–º–∏ –∏ –Ω–∞ –ø—è—Ç–∫–∏." }
        };

        function openWuduModal(id) {
            const data = wuduData[id];
            const content = document.getElementById('wuduModalContent');
            content.innerHTML = `
                <div class="text-6xl text-center mb-4">${data.icon}</div>
                <h3 class="text-3xl font-black text-teal-900 text-center">${data.title}</h3>
                <p class="text-slate-600 leading-relaxed text-center font-medium">${data.desc}</p>
                <div class="flex justify-center pt-4">
                    <button onclick="closeWuduModal()" class="bg-teal-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-teal-700 transition-all">–ü–æ–Ω—è—Ç–Ω–æ</button>
                </div>
            `;
            document.getElementById('wuduModal').classList.add('active');
        }

        function closeWuduModal() {
            document.getElementById('wuduModal').classList.remove('active');
        }

        // --- –ò–ò –í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ ---
        async function fetchInspiration() {
            const btn = document.getElementById('inspire-btn');
            const label = document.getElementById('inspire-label');
            const loader = document.getElementById('inspire-loader');
            const textEl = document.getElementById('inspiration-text');
            const statusEl = document.getElementById('ai-error-status');

            btn.disabled = true;
            label.classList.add('hidden');
            loader.classList.remove('hidden');
            statusEl.classList.add('hidden');

            const result = await callGemini("–î–∞–π –æ–¥–Ω–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞, –Ω–∞—á–∏–Ω–∞—é—â–µ–≥–æ —É—á–∏—Ç—å –Ω–∞–º–∞–∑. –ë—É–¥—å –¥–æ–±—Ä—ã–º –∏ –º—É–¥—Ä—ã–º.", "–¢—ã - –º—É–¥—Ä—ã–π –∏—Å–ª–∞–º—Å–∫–∏–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫.");

            if (result.startsWith("### –û–®–ò–ë–ö–ê")) {
                statusEl.innerText = result.replace("### ", "");
                statusEl.classList.remove('hidden');
            } else {
                textEl.innerText = result;
            }

            btn.disabled = false;
            label.classList.remove('hidden');
            loader.classList.add('hidden');
        }

        // --- AI –ß–∞—Ç ---
        function toggleChat() {
            document.getElementById('aiChat').classList.toggle('active');
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const container = document.getElementById('chatMessages');
            const text = input.value.trim();
            if (!text) return;

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userMsg = document.createElement('div');
            userMsg.className = 'message message-user px-4 py-3 shadow-sm';
            userMsg.innerText = text;
            container.appendChild(userMsg);
            input.value = '';
            container.scrollTop = container.scrollHeight;

            // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
            const loadingMsg = document.createElement('div');
            loadingMsg.className = 'message message-ai px-4 py-3 opacity-70 italic shadow-sm';
            loadingMsg.innerHTML = '<span class="loading-dots">–ù–∞—Å—Ç–∞–≤–Ω–∏–∫ –¥—É–º–∞–µ—Ç</span>';
            container.appendChild(loadingMsg);
            container.scrollTop = container.scrollHeight;

            const result = await callGemini(text, "–¢—ã - —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–π –¥—É—Ö–æ–≤–Ω—ã–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –¥–æ—Å—Ç—É–ø–Ω–æ –∏ —Ç–æ–ª—å–∫–æ –ø–æ —Ç–µ–º–µ —Ä–µ–ª–∏–≥–∏–∏. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –Ω–µ –∫–∞—Å–∞–µ—Ç—Å—è –∏—Å–ª–∞–º–∞ –∏–ª–∏ –Ω–∞–º–∞–∑–∞, –≤–µ–∂–ª–∏–≤–æ –æ—Ç–∫–∞–∂–∏—Å—å.");

            loadingMsg.classList.remove('italic', 'opacity-70');
            if (result.startsWith("### –û–®–ò–ë–ö–ê")) {
                loadingMsg.innerHTML = `<span class="text-red-500 font-bold block mb-1">–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏</span><span class="text-[10px] opacity-60 leading-tight block">${result}</span>`;
            } else {
                loadingMsg.innerText = result;
            }
            container.scrollTop = container.scrollHeight;
        }

        // --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–∞—Ñ–∏–∫–æ–≤ Chart.js ---
        function wrapLabel(str, max = 16) {
            if (str.length <= max) return str;
            const words = str.split(' ');
            const lines = [];
            let currentLine = words[0];
            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= max) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        const chartDefaults = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                tooltip: {
                    backgroundColor: 'rgba(0, 137, 123, 0.9)',
                    titleFont: { size: 14, weight: '800' },
                    bodyFont: { size: 13 },
                    padding: 12,
                    cornerRadius: 12,
                    callbacks: {
                        title: function (tooltipItems) {
                            const label = tooltipItems[0].chart.data.labels[tooltipItems[0].dataIndex];
                            return Array.isArray(label) ? label.join(' ') : label;
                        }
                    }
                },
                legend: {
                    position: 'bottom',
                    labels: {
                        boxWidth: 10,
                        usePointStyle: true,
                        padding: 25,
                        font: { size: 12, weight: '700' },
                        color: '#1A3A3A'
                    }
                }
            }
        };

        window.addEventListener('DOMContentLoaded', () => {
            // 1. Radar Chart
            new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: {
                    labels: ["–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –¥—É—Ö–∞", "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø–æ–∫–æ–π", "–§–æ–∫—É—Å –≤–Ω–∏–º–∞–Ω–∏—è", "–¢–µ–ª–µ—Å–Ω–∞—è —Å–∏–ª–∞", "–ß–∏—Å—Ç–æ—Ç–∞ –º—ã—Å–ª–µ–π"].map(l => wrapLabel(l)),
                    datasets: [{
                        label: '–í–ª–∏—è–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏',
                        data: [92, 98, 85, 75, 100],
                        backgroundColor: 'rgba(0, 137, 123, 0.15)',
                        borderColor: '#00897B',
                        pointBackgroundColor: '#FFCA28',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 3,
                        pointRadius: 5,
                        borderWidth: 4
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        r: {
                            ticks: { display: false },
                            grid: { color: '#E0F2F1' },
                            angleLines: { color: '#E0F2F1' },
                            pointLabels: { font: { size: 11, weight: '700' } }
                        }
                    }
                }
            });

            // 2. Stacked Bar Chart
            new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: ["–£—Ç—Ä–µ–Ω–Ω—è—è (–§–∞–¥–∂—Ä)", "–ü–æ–ª—É–¥–µ–Ω–Ω–∞—è (–ó—É—Ö—Ä)", "–ü—Ä–µ–¥–≤–µ—á–µ—Ä–Ω—è—è (–ê—Å—Ä)", "–í–µ—á–µ—Ä–Ω—è—è (–ú–∞–≥—Ä–∏–±)", "–ù–æ—á–Ω–∞—è (–ò—à–∞)"].map(l => wrapLabel(l)),
                    datasets: [
                        { label: '–§–∞—Ä–¥ (–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)', data: [2, 4, 4, 3, 4], backgroundColor: '#00897B', borderRadius: 12, barThickness: 40 },
                        { label: '–°—É–Ω–Ω–∞ (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ)', data: [2, 6, 0, 2, 6], backgroundColor: '#FFCA28', borderRadius: 12, barThickness: 40 }
                    ]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        x: { stacked: true, grid: { display: false } },
                        y: { stacked: true, beginAtZero: true, grid: { color: '#F0F7F7' } }
                    }
                }
            });

            // 3. Line Chart
            new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: {
                    labels: ["–†–∞—Å—Å–≤–µ—Ç", "–ü–æ–ª–¥–µ–Ω—å", "–ü–æ—Å–ª–µ –ø–æ–ª—É–¥–Ω—è", "–ó–∞–∫–∞—Ç", "–ü–æ–∑–¥–Ω–∏–π –≤–µ—á–µ—Ä"].map(l => wrapLabel(l)),
                    datasets: [{
                        label: '–£—Ä–æ–≤–µ–Ω—å –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏',
                        data: [98, 85, 82, 90, 95],
                        borderColor: '#00897B',
                        backgroundColor: 'rgba(0, 137, 123, 0.05)',
                        fill: true,
                        tension: 0.5,
                        borderWidth: 6,
                        pointRadius: 8,
                        pointHoverRadius: 12,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#00897B',
                        pointBorderWidth: 4
                    }]
                },
                options: {
                    ...chartDefaults,
                    scales: {
                        y: { beginAtZero: true, max: 100, grid: { color: '#F0F7F7' } },
                        x: { grid: { display: false } }
                    }
                }
            });

            // –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ —á–∞—Ç–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ –≤–Ω–∏–∑ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (UX —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)
            let lastScroll = 0;
            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;
                const chat = document.getElementById('aiChat');
                if (currentScroll > lastScroll && chat.classList.contains('active')) {
                    chat.classList.remove('active'); // –°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–∏—Å—Ç–∞–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç
                }
                lastScroll = currentScroll;
            });
        });
    </script>
</body>

</html>